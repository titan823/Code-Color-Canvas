<!-- CodeMirror（CDN） -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-darker.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>

<style>
    /* 全体 */
    :root {
        --bg: #1e1e1e;
        --panel: #252526;
        --panel-2: #2d2d2d;
        --panel-3: #333;
        --border-1: #444;
        --accent: #007acc;
        --text: #d4d4d4;
        --muted: #aaaaaa;
        --ok: #7bd88f;
        --ng: #f26d6d;
        --shadow: rgba(0,0,0,0.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
        background-color: var(--bg);
        color: var(--text);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }
    header {
        background-color: var(--panel-3);
        padding: 10px 20px;
        font-size: 1.2em;
        font-weight: bold;
        border-bottom: 2px solid var(--accent);
    }

    /* 上位タブ（編集 / プレビュー / 画像カラー分析） */
    .main-container {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-height: 0;
    }
    .top-tabs {
        display: flex;
        background-color: var(--bg);
        border-bottom: 2px solid var(--border-1);
    }
    .top-tab-button {
        padding: 10px 16px;
        border: none;
        background-color: var(--panel-2);
        color: #ccc;
        cursor: pointer;
        border-bottom: 3px solid transparent;
    }
    .top-tab-button + .top-tab-button {
        border-left: 1px solid var(--border-1);
    }
    .top-tab-button.active {
        background-color: var(--panel-3);
        color: white;
        border-bottom: 3px solid var(--accent);
    }

    .page-container {
        position: relative;
        flex: 1;
        min-height: 0;
    }
    .tab-page {
        position: absolute;
        inset: 0;
        display: none;
    }
    .tab-page.active {
        display: flex;
        flex-direction: column;
        min-height: 0;
    }

    /* パネル共通 */
    .panel-header {
        background-color: var(--panel-3);
        padding: 8px 12px;
        font-weight: bold;
        border-bottom: 1px solid var(--border-1);
    }
    .panel {
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: 0;
    }

    /* コードエディタ */
    .code-tabs {
        display: flex;
        background-color: var(--bg);
        border-bottom: 1px solid var(--border-1);
    }
    .tab-button {
        padding: 10px 15px;
        border: none;
        background-color: var(--panel-2);
        color: #ccc;
        cursor: pointer;
        border-bottom: 3px solid transparent;
    }
    .tab-button.active {
        background-color: var(--panel-3);
        color: white;
        border-bottom: 3px solid var(--accent);
    }
    .editor-container {
        flex: 1;
        position: relative;
        min-height: 0;
    }
    .CodeMirror {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100% !important;
        font-size: 14px;
    }
    .editor-wrapper {
        display: none;
        height: 100%;
    }
    .editor-wrapper.active {
        display: block;
    }

    /* プレビュー・変更（左右分割） */
    .split-container {
        display: flex;
        flex: 1;
        min-height: 0;
    }
    .split-left, .split-right {
        display: flex;
        flex-direction: column;
        min-height: 0;
    }
    .split-left {
        flex: 1 1 55%;
        border-right: 2px solid var(--border-1);
        min-width: 320px;
    }
    .split-right {
        flex: 1 1 45%;
        min-width: 320px;
    }
    .frame-wrap {
        flex: 1;
        min-height: 0;
    }
    #preview-frame {
        width: 100%;
        height: 100%;
        border: none;
        background-color: #fff;
    }

    /* インスペクター（プレビュー・変更タブ右側） */
    .inspector-body {
        flex: 1;
        background-color: var(--panel);
        padding: 15px;
        overflow-y: auto;
    }
    .inspector-item {
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }
    .inspector-item label {
        min-width: 120px;
        font-size: 0.9em;
        color: var(--muted);
    }
    .inspector-item input[type="text"],
    .inspector-item textarea {
        background-color: #3c3c3c;
        border: 1px solid #555;
        color: #f0f0f0;
        padding: 6px 8px;
        border-radius: 3px;
        flex: 1 1 240px;
    }
    .inspector-item textarea {
        min-height: 60px;
        resize: vertical;
    }
    .color-swatch {
        width: 18px;
        height: 18px;
        border: 1px solid #555;
        border-radius: 3px;
        background: transparent;
    }
    .validity-badge {
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 10px;
        border: 1px solid #555;
        color: #ddd;
    }
    .validity-badge.ok { border-color: #2e7d32; color: var(--ok); }
    .validity-badge.ng { border-color: #8e2a2a; color: var(--ng); }
    .inspector-actions { display: inline-flex; gap: 6px; align-items: center; }
    .btn {
        background: var(--panel-2);
        border: 1px solid #555;
        color: #eee;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
    }
    .btn:hover { background: #3a3a3a; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* 画像カラー分析タブ */
    .img-toolbar {
        padding: 8px 12px;
        background: var(--panel-2);
        border-bottom: 1px solid var(--border-1);
    }
    .toolbar-row {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 8px;
    }
    .toolbar-row:last-child {
        margin-bottom: 0;
    }
    .img-toolbar input[type="text"] {
        background: #3c3c3c; border: 1px solid #555; color: #f0f0f0; padding: 6px 8px; border-radius: 3px;
        min-width: 200px; flex: 1 1 200px;
    }
    .img-toolbar input[type="file"] { color: #ddd; }
    .img-switcher {
        display: flex; gap: 6px; align-items: center; flex-wrap: wrap;
        padding: 8px 12px; background: var(--panel-2); border-bottom: 1px solid var(--border-1);
    }
    .img-chip {
        padding: 4px 10px; border: 1px solid #555; border-radius: 16px; background: #2f2f2f; color: #ddd; cursor: pointer;
    }
    .img-chip.active { background: var(--accent); border-color: var(--accent); color: #fff; }
    .img-stage {
        position: relative; flex: 1; min-height: 0;
        background: conic-gradient(#eee 25%, #fff 0 50%, #eee 0 75%, #fff 0) 0 0 / 16px 16px;
    }
    #image-canvas { width: 100%; height: 100%; display: block; background: transparent; }
    #magnifier-canvas {
        position: absolute; width: 140px; height: 140px;
        border: 1px solid #666; border-radius: 6px; box-shadow: 0 6px 18px var(--shadow);
        display: none; pointer-events: none; background: #111;
    }
    .img-stage.picking #image-canvas { cursor: crosshair; }
    .img-stage.blurring #image-canvas { cursor: none; }
    .stage-hint {
        position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
        color: #ccc; font-size: 0.95em; text-align: center; padding: 8px; pointer-events: none;
    }
    .stage-overlay {
        position: absolute; inset: 0; border: 2px dashed #666; border-radius: 8px; pointer-events: none; margin: 8px;
    }
    .panel-section-title { font-weight: bold; margin: 12px 0 6px; color: #fff; }
    .current-color { display: flex; align-items: center; gap: 10px; }
    .swatch-large { width: 64px; height: 64px; border: 1px solid #555; border-radius: 6px; background: #000; }
    .kv-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
    .kv-row code {
        background: #2a2a2a; border: 1px solid #555; padding: 4px 6px; border-radius: 4px; color: #eee; word-break: break-all;
    }
    .copy-btn { padding: 4px 8px; }
    .contrast-box { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 6px; }
    .contrast-sample { height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 6px; border: 1px solid #555; font-weight: 600; }
    .history-list { display: flex; flex-wrap: wrap; gap: 8px; }
    .history-item { width: 28px; height: 28px; border: 1px solid #555; border-radius: 4px; cursor: pointer; }
    .status-line { font-size: 0.85em; color: #ccc; padding: 4px 12px; border-top: 1px solid #444; background: #2b2b2b; }
    .note { color: #bbb; font-size: 0.85em; }

    /* タッチオフセット */
    .touch-offset-group {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        background: rgba(0,0,0,0.3);
        border-radius: 4px;
    }
    .touch-offset-group input[type="number"] { padding: 2px 4px; width: 70px; }

    /* ブラシ設定 / 調整設定 */
    .brush-settings, .adjust-settings {
        padding: 8px 12px;
        background: var(--panel-2);
        border-bottom: 1px solid var(--border-1);
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }
    .brush-settings label, .adjust-settings label { display: flex; align-items: center; gap: 6px; }
    .brush-settings input[type="range"], .adjust-settings input[type="range"] { width: 140px; }

    /* ポインターマーカー */
    #pointer-marker {
        position: absolute;
        width: 24px; height: 24px;
        border: 2px solid #00ff00; border-radius: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none; z-index: 1000; display: none;
    }
    #pointer-marker::before, #pointer-marker::after {
        content: ''; position: absolute; background: #00ff00;
    }
    #pointer-marker::before { width: 2px; height: 8px; left: 50%; top: -10px; transform: translateX(-50%); }
    #pointer-marker::after { width: 8px; height: 2px; left: -10px; top: 50%; transform: translateY(-50%); }

    /* ブラシプレビュー */
    #brush-preview {
        position: absolute;
        border: 2px solid rgba(255,255,255,0.8); border-radius: 50%;
        pointer-events: none; z-index: 999; display: none;
        box-shadow: 0 0 0 1px rgba(0,0,0,0.5);
        transform: translate(-50%, -50%);
    }

    /* オフセットライン */
    #offset-line {
        position: absolute;
        border-left: 1px dashed rgba(255,255,255,0.5);
        pointer-events: none; z-index: 998; display: none;
        transform-origin: top left;
    }
</style>
Code Color Canvas
<main class="main-container">
    <!-- 上位タブ -->
    <div class="top-tabs">
        <button class="top-tab-button active" onclick="showMainTab('code')">コード編集</button>
        <button class="top-tab-button" onclick="showMainTab('preview')">プレビュー・変更</button>
        <button class="top-tab-button" onclick="showMainTab('image')">画像カラー分析</button>
    </div>

    <div class="page-container">
        <!-- コード編集タブ -->
        <section id="code-page" class="tab-page active">
            <div class="panel code-panel">
                <div class="panel-header">コード編集</div>
                <div class="code-tabs">
                    <button class="tab-button active" onclick="showEditor('html')">HTML</button>
                    <button class="tab-button" onclick="showEditor('css')">CSS</button>
                    <button class="tab-button" onclick="showEditor('js')">JavaScript</button>
                </div>
                <div class="editor-container">
                    <div id="html-editor-wrapper" class="editor-wrapper active">
                        <textarea id="html-code"></textarea>
                    </div>
                    <div id="css-editor-wrapper" class="editor-wrapper">
                        <textarea id="css-code"></textarea>
                    </div>
                    <div id="js-editor-wrapper" class="editor-wrapper">
                        <textarea id="js-code"></textarea>
                    </div>
                </div>
            </div>
        </section>

        <!-- プレビュー・変更タブ（左右分割） -->
        <section id="preview-page" class="tab-page">
            <div class="split-container">
                <div class="split-left">
                    <div class="panel-header">プレビュー</div>
                    <div class="frame-wrap">
                        <iframe id="preview-frame"></iframe>
                    </div>
                </div>
                <div class="split-right">
                    <div class="panel-header">インスペクター</div>
                    <div class="inspector-body">
                        <p id="inspector-placeholder">プレビュー内の要素をクリックすると、ここでテキストやスタイルを編集できます。</p>
                        <div id="inspector-ui" style="display: none;">
                            <div class="inspector-item">
                                <label>選択中の要素</label>
                                <b id="selected-element-selector"></b>
                            </div>

                            <!-- テキスト編集 -->
                            <div class="inspector-item">
                                <label for="inspector-text">テキスト</label>
                                <textarea id="inspector-text" placeholder="選択した要素のテキストを編集"></textarea>
                                <div class="inspector-actions">
                                    <label style="display:inline-flex; align-items:center; gap:6px; color:#ccc; font-size: 0.9em;">
                                        <input type="checkbox" id="inspector-text-as-html"> HTMLとして編集
                                    </label>
                                    <button class="btn" id="apply-text">適用</button>
                                </div>
                            </div>

                            <!-- テキスト色 -->
                            <div class="inspector-item">
                                <label for="inspector-color">テキスト色</label>
                                <input type="text" id="inspector-color" placeholder="例: #ff8800, rgb(255 136 0 / 80%), hsl(30 100% 50%), rebeccapurple, color(display-p3 1 0.5 0)">
                                <span class="color-swatch" id="swatch-color"></span>
                                <span class="validity-badge" id="valid-color">未入力</span>
                                <div class="inspector-actions">
                                    <button class="btn" id="apply-color" disabled>適用</button>
                                    <button class="btn" id="undo-color" disabled>元に戻す</button>
                                    <button class="btn" id="redo-color" disabled>やり直す</button>
                                </div>
                            </div>

                            <!-- 背景色 -->
                            <div class="inspector-item">
                                <label for="inspector-bg">背景色</label>
                                <input type="text" id="inspector-bg" placeholder="例: transparent, #222, rgba(0 0 0 / .4), lch(50 60 40)">
                                <span class="color-swatch" id="swatch-bg"></span>
                                <span class="validity-badge" id="valid-bg">未入力</span>
                                <div class="inspector-actions">
                                    <button class="btn" id="apply-bg" disabled>適用</button>
                                    <button class="btn" id="undo-bg" disabled>元に戻す</button>
                                    <button class="btn" id="redo-bg" disabled>やり直す</button>
                                </div>
                            </div>

                            <!-- ボックス系 -->
                            <div class="inspector-item">
                                <label for="inspector-padding">パディング</label>
                                <input type="text" id="inspector-padding" placeholder="例: 10px / 8px 12px / 1rem 2rem">
                            </div>
                            <div class="inspector-item">
                                <label for="inspector-margin">マージン</label>
                                <input type="text" id="inspector-margin" placeholder="例: 10px auto / 0 16px">
                            </div>
                            <div class="inspector-item">
                                <label for="inspector-fontSize">フォントサイズ</label>
                                <input type="text" id="inspector-fontSize" placeholder="例: 16px / 1.2rem / clamp(14px, 2vw, 20px)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 画像カラー分析タブ（左右分割） -->
        <section id="image-page" class="tab-page">
            <div class="split-container">
                <!-- 左：画像 -->
                <div class="split-left">
                    <div class="panel-header">画像</div>

                    <!-- 段落1：読み込み -->
                    <div class="img-toolbar">
                        <div class="toolbar-row">
                            <input type="file" id="img-file" accept="image/*" multiple>
                            <input type="text" id="img-url" placeholder="画像URL（CORS対応のもの）">
                            <button class="btn" id="btn-load-url">読込</button>
                            <span class="note">最大10枚まで同時管理・番号で切替</span>
                        </div>
                        <!-- 段落2：スポイト・ブラシ・オフセット -->
                        <div class="toolbar-row">
                            <button class="btn" id="btn-eyedropper" title="対応ブラウザのみ">画面スポイト</button>
                            <button class="btn" id="btn-canvas-picker">キャンバススポイト</button>
                            <button class="btn" id="btn-blur-brush">ボカシブラシ</button>
                            <div class="touch-offset-group">
                                <label><input type="checkbox" id="touch-offset-enabled" checked>タッチオフセット</label>
                                <input type="number" id="touch-offset-value" value="100" min="0" max="300">
                                <span>px</span>
                            </div>
                        </div>
                    </div>

                    <!-- ブラシ設定 -->
                    <div class="brush-settings" id="blur-brush-settings" style="display: none;">
                        <label>ブラシサイズ: <span id="brush-size-display">20</span>px</label>
                        <input type="range" id="brush-size" min="5" max="160" value="20">
                        <label>ボカシ強度: <span id="blur-strength-display">10</span>px</label>
                        <input type="range" id="blur-strength" min="1" max="100" value="10">
                        <button class="btn" id="btn-undo-blur" disabled>編集を元に戻す</button>
                        <button class="btn" id="btn-reset-blur" disabled>画像をリセット</button>
                    </div>

                    <!-- 調整設定（彩度・輝度） -->
                    <div class="adjust-settings" id="adjust-settings">
                        <label>彩度: <span id="sat-display">100</span>%</label>
                        <input type="range" id="sat-slider" min="0" max="300" value="100">
                        <label>輝度: <span id="bright-display">0</span></label>
                        <input type="range" id="bright-slider" min="-100" max="100" value="0">
                        <button class="btn" id="btn-reset-adjust">調整リセット</button>
                    </div>

                    <div class="img-switcher" id="img-switcher"></div>
                    <div class="img-stage" id="image-stage">
                        <canvas id="image-canvas"></canvas>
                        <canvas id="magnifier-canvas" width="140" height="140"></canvas>
                        <div class="stage-hint" id="stage-hint">画像を読み込むか、ここにドラッグ＆ドロップしてください（複数可）</div>
                        <div class="stage-overlay" id="stage-overlay" style="display:none;"></div>
                    </div>
                    <div class="status-line" id="img-status"></div>
                </div>

                <!-- 右：分析結果 -->
                <div class="split-right">
                    <div class="panel-header">カラー分析</div>
                    <div class="inspector-body" id="image-inspector">
                        <div class="panel-section-title">現在の色</div>
                        <div class="current-color">
                            <div class="swatch-large" id="current-swatch"></div>
                            <div id="current-color-text">未取得</div>
                        </div>

                        <div class="panel-section-title">表記</div>
                        <div class="kv-row"><label style="min-width:80px;">HEX</label><code id="hex-val">-</code><button class="btn copy-btn" data-copy-target="hex-val">コピー</button></div>
                        <div class="kv-row"><label style="min-width:80px;">HEXA</label><code id="hexa-val">-</code><button class="btn copy-btn" data-copy-target="hexa-val">コピー</button></div>
                        <div class="kv-row"><label style="min-width:80px;">RGB(A)</label><code id="rgb-val">-</code><button class="btn copy-btn" data-copy-target="rgb-val">コピー</button></div>
                        <div class="kv-row"><label style="min-width:80px;">HSL(A)</label><code id="hsl-val">-</code><button class="btn copy-btn" data-copy-target="hsl-val">コピー</button></div>

                        <div class="panel-section-title">視認性</div>
                        <div class="kv-row"><label style="min-width:120px;">相対輝度</label><code id="luminance-val">-</code></div>
                        <div class="kv-row"><label style="min-width:120px;">コントラスト比</label>
                            <div>対黒: <code id="contrast-black">-</code></div>
                            <div>対白: <code id="contrast-white">-</code></div>
                        </div>
                        <div class="contrast-box">
                            <div class="contrast-sample" id="contrast-on-black" style="background:#000;color:#fff;">サンプル</div>
                            <div class="contrast-sample" id="contrast-on-white" style="background:#fff;color:#000;">サンプル</div>
                        </div>

                        <div class="panel-section-title">履歴（画像ごとに保存）</div>
                        <div class="history-list" id="history-list"></div>
                        <p class="note">画面スポイトはChrome/Edgeなどで使用可能です。URL読み込みはCORS対応の画像のみキャンバス内スポイトが動作します（ローカルファイルはOK）。</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- グローバル（プレビュー・変更タブ関連） ---
        let selectedElement = null;
        let lastHighlightedElement = null;
        let lastSelectedSelectorPath = null;

        // インラインCSS変更の履歴（Undo/Redo）
        const colorHistory = new Map();
        function getHistory(selector) {
            if (!colorHistory.has(selector)) {
                colorHistory.set(selector, {
                    color: { undo: [], redo: [] },
                    backgroundColor: { undo: [], redo: [] }
                });
            }
            return colorHistory.get(selector);
        }

        // --- CodeMirror 初期化 ---
        const htmlEditor = CodeMirror.fromTextArea(document.getElementById('html-code'), {
            mode: 'xml',
            htmlMode: true,
            theme: 'material-darker',
            lineNumbers: true,
        });
        const cssEditor = CodeMirror.fromTextArea(document.getElementById('css-code'), {
            mode: 'css',
            theme: 'material-darker',
            lineNumbers: true,
        });
        const jsEditor = CodeMirror.fromTextArea(document.getElementById('js-code'), {
            mode: 'javascript',
            theme: 'material-darker',
            lineNumbers: true,
        });

        // --- 初期コード ---
        const initialHTML = `<div class="container">
Code Color Canvasへようこそ！
ここにあるテキストやスタイルを自由に編集できます。

クリック `; const initialCSS = `/* ページ全体のスタイル */ html, body { height: 100%; } body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; margin: 0; }
.container { text-align: center; padding: 40px; background-color: white; border-radius: 12px; box-shadow: 0 6px 16px rgba(0,0,0,0.12); }

#main-title { color: #333; margin: 0 0 10px 0; }

#action-btn { background-color: #007acc; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; }; const initialJS = document.getElementById('action-btn')?.addEventListener('click', (e) => { alert('ボタンがクリックされました！'); });`; htmlEditor.setValue(initialHTML); cssEditor.setValue(initialCSS); jsEditor.setValue(initialJS);

        // --- 上位タブ切替 ---
        window.showMainTab = function(name) {
            document.querySelectorAll('.top-tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-page').forEach(p => p.classList.remove('active'));
            document.querySelector(\`.top-tab-button[onclick="showMainTab('\${name}')"]\`).classList.add('active');
            document.getElementById(name === 'code' ? 'code-page' : name === 'preview' ? 'preview-page' : 'image-page').classList.add('active');
            if (name === 'code') {
                htmlEditor.refresh(); cssEditor.refresh(); jsEditor.refresh();
            } else if (name === 'image') {
                if (typeof resizeImageStage === 'function') resizeImageStage();
            }
        };

        // --- サブタブ切替 ---
        window.showEditor = function(editorName) {
            document.querySelectorAll('.editor-wrapper').forEach(w => w.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(\`\${editorName}-editor-wrapper\`).classList.add('active');
            document.querySelector(\`.tab-button[onclick="showEditor('\${editorName}')"]\`).classList.add('active');
            if (editorName === 'html') htmlEditor.refresh();
            if (editorName === 'css') cssEditor.refresh();
            if (editorName === 'js') jsEditor.refresh();
        };

        // --- プレビュー更新 ---
        function updatePreview() {
            const iframe = document.getElementById('preview-frame');
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            const htmlCode = htmlEditor.getValue();
            const cssCode = cssEditor.getValue();
            const jsCode = jsEditor.getValue();

            doc.open();
            doc.write(`<!DOCTYPE html>

